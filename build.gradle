// Available to customize the build

plugins {
    id "com.moowork.node" version "1.2.0"
}

/*
 * Javadoc
 */
task aggregatedJavadocs(type: Javadoc, description: 'Generate javadocs from all child projects as if it was a single project', group: 'Documentation') {
	destinationDir = file("$buildDir/site/javadoc")
    title = "OpenEMS Javadoc"
	subprojects.each { proj ->
		proj.tasks.withType(Javadoc).each { javadocTask ->
			source += javadocTask.source
			classpath += javadocTask.classpath
			excludes += javadocTask.excludes
			includes += javadocTask.includes
		}
	}
}

/*
 * Antora docs
 */
task prepareAntora(type: NpmTask) {
    node {
        download = true
        nodeModulesDir = file("$buildDir/modules")
    }
    args = ['install', '--global', '@antora/cli', '@antora/site-generator-default']
}

task antora(type:Exec, dependsOn: 'prepareAntora') {
// task antora(type:Exec) {
    // workingDir './doc/build'
    // workingDir "$buildDir/modules"
    // commandLine "./node_modules/.bin/antora.cmd", 'site.yml'
    // commandLine "$buildDir/modules/node_modules/.bin/antora.cmd", 'site.yml'
    commandLine '.gradle/nodejs/node-v6.9.1-linux-x64/bin/antora', '--generator', '.gradle/nodejs/node-v6.9.1-linux-x64/lib/node_modules/@antora/site-generator-default', 'site.yml'
}
