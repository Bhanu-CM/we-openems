= Timedata TimescaleDB

OpenEMS Backend implementation for TimescaleDB: https://timescale.com

== Setup TimescaleDB on Debian

See https://docs.timescale.com/install/latest/self-hosted/installation-debian/
for reference.


[source,bash]
----
apt install gnupg postgresql-common apt-transport-https lsb-release wget

/usr/share/postgresql-common/pgdg/apt.postgresql.org.sh

curl -s https://packagecloud.io/install/repositories/timescale/timescaledb/script.deb.sh | bash

apt install timescaledb-2-postgresql-14 timescaledb-tools

timescaledb-tune --quiet --yes

# Open port 5432
vim /etc/postgresql/14/main/postgresql.conf
    listen_addresses = '*'
    data_directory = '/opt/postgresql'
vim /etc/postgresql/14/main/pg_hba.conf
    host    all             all              0.0.0.0/0                       md5

# Firewall
ufw allow to any port 5432

# Apply configuration changes
systemctl restart postgresql

cd /tmp
su postgres -c psql

CREATE USER openems WITH ENCRYPTED PASSWORD 'password';

CREATE DATABASE data OWNER openems;

# Use 'data' db
\c data

CREATE EXTENSION IF NOT EXISTS timescaledb;

exit

psql -X --host=127.0.0.1 -W -U openems data

# Execute output of SchemaGenerator.java

----

== Update TimescaleDB extension

[source,bash]
----
su postgres -c psql
\c data
ALTER EXTENSION timescaledb UPDATE;
exit
----

== Delete all data

Be aware: following commands DELETE ALL YOUR DATA!

[source,bash]
----
cd /tmp
su postgres -c psql

REVOKE CONNECT ON DATABASE data FROM PUBLIC;
exit

systemctl restart postgresql
su postgres -c psql

DROP DATABASE data;
CREATE DATABASE data OWNER openems;

\c data

CREATE EXTENSION IF NOT EXISTS timescaledb;

exit
----

https://github.com/OpenEMS/openems/tree/develop/io.openems.backend.timedata.timescaledb[Source Code icon:github[]]
