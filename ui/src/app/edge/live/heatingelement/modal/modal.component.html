<ion-header>
    <ion-toolbar class="ion-justify-content-center" color="primary">
        <ion-title *ngIf="controller.alias != controller.id">{{ controller.alias }}</ion-title>
        <ion-title *ngIf="controller.alias == controller.id">{{ controller.id }}</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="modalCtrl.dismiss()">
                <ion-icon name="close"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ng-container *ngIf="controller && service.currentEdge | async as edge">
        <ng-container *ngIf="edge.currentData | async as currentData">
            <ion-card-content class="underline" *ngIf="currentData.channel[outputChannelPhaseOne] != null && currentData.channel[outputChannelPhaseTwo] != null
            && currentData.channel[outputChannelPhaseThree] != null">
                <table class="full_width">
                    <tr>
                        <td style="width:65%"><span translate>General.Phase</span>&nbsp;L1</td>
                        <td class="align_right" style="width: 35%"
                            *ngIf="currentData.channel[outputChannelPhaseOne] == 1" translate>
                            General.Active
                        </td>
                        <td class="align_right" style="width: 35%"
                            *ngIf="currentData.channel[outputChannelPhaseOne] == 0" translate>
                            General.Inactive
                        </td>
                    </tr>
                    <tr>
                        <td style="width:65%"><span translate>General.Phase</span>&nbsp;L2</td>
                        <td class="align_right" style="width: 35%"
                            *ngIf="currentData.channel[outputChannelPhaseTwo] == 1" translate>
                            General.Active
                        </td>
                        <td class="align_right" style="width: 35%"
                            *ngIf="currentData.channel[outputChannelPhaseTwo] == 0" translate>
                            General.Inactive
                        </td>
                    </tr>
                    <tr>
                        <td style="width:65%"><span translate>General.Phase</span>&nbsp;L3</td>
                        <td class="align_right" style="width: 35%"
                            *ngIf="currentData.channel[outputChannelPhaseThree] == 1" translate>
                            General.Active
                        </td>
                        <td class="align_right" style="width: 35%"
                            *ngIf="currentData.channel[outputChannelPhaseThree] == 0" translate>
                            General.Inactive
                        </td>
                    </tr>
                </table>
            </ion-card-content>
        </ng-container>
    </ng-container>
    <ion-card-content class="underline">
        <table class="full_width">
            <tr>
                <td translate>
                    General.Mode
                </td>
            </tr>
        </table>
        <ion-segment (ionChange)="updateMode($event, controller)" value="{{controller.properties['mode']}}"
            scrollable="false">
            <ion-segment-button value="MANUAL_ON">
                <ion-label translate>
                    General.On
                </ion-label>
                <ion-icon color="success" style="width:40px" name="power"></ion-icon>
            </ion-segment-button>
            <ion-segment-button value="AUTOMATIC">
                <ion-label translate>
                    General.Automatic
                </ion-label>
                <ion-icon style="width:40px" name="sunny">
                </ion-icon>
            </ion-segment-button>
            <ion-segment-button value="MANUAL_OFF">
                <ion-label translate>
                    General.Off
                </ion-label>
                <ion-icon name="power" style="width: 40px"></ion-icon>
            </ion-segment-button>
        </ion-segment>
    </ion-card-content>
    <ion-card-content>
        <ion-grid>
            <ion-row class="ion-justify-content-center">
                <ion-item lines="none">
                    Endzeit:
                    <ion-datetime (ionChange)="updateEndTime($event, controller)"
                        value="{{controller.properties['endTime']}}" [pickerOptions]="customPickerOptions"
                        displayFormat="HH:mm">
                    </ion-datetime>
                </ion-item>
            </ion-row>
            <!-- for spacing -->
            <div style="padding-top: 10px;"></div>
            <ion-row class="ion-justify-content-center">
                <ion-segment value={{modimode}} class="small">
                    <ion-segment-button value="ZEIT">
                        <ion-item lines="none">
                            <ion-icon style="width:40px" name="sunny">
                            </ion-icon>
                            <ion-label>
                                ZEIT
                            </ion-label>
                        </ion-item>
                    </ion-segment-button>
                    <ion-segment-button value="KWH">
                        <ion-item lines="none">
                            <ion-img style="width:30px" src="assets/img/gridStorage.png">
                            </ion-img>
                            <ion-label>
                                KWH
                            </ion-label>
                        </ion-item>
                    </ion-segment-button>
                </ion-segment>
            </ion-row>
        </ion-grid>
        <table class="full_width">
            <tr>
                <ion-item lines="none" class="ion-no-padding">
                    <ion-label class="heating">Phasen</ion-label>
                    <ion-select cancelText='Abbrechen' multiple="true" [interfaceOptions]="selectOptions"
                        class="align_right">
                        <ion-select-option class="heating">Phase 1</ion-select-option>
                        <ion-select-option class="heating">Phase 2</ion-select-option>
                        <ion-select-option class="heating">Phase 3</ion-select-option>
                    </ion-select>
                </ion-item>
            </tr>
        </table>
        <table class="full_width">
            <tr>
                <td style="width: 65%">
                    Mindestlaufzeit</td>
                <td style="width: 35%" class="align_right">
                    {{5 | unitvalue:'H'}}</td>
            </tr>
        </table>
        <table class="full_width" *ngIf="modimode == 'ZEIT'">
            <tr>
                <ion-range style="width: 100%" min="0" max="8" color="dark" pin="true" style="padding-top: 8px;"
                    step="100" debounce="500" value="{{controller.properties['forceChargeMinPower']}}">
                    <ion-label slot="start">
                        {{ 0 | unitvalue:'H'}}
                    </ion-label>
                    <ion-label slot="end">
                        {{ 8 | unitvalue:'H'}}
                    </ion-label>
                </ion-range>
            </tr>
        </table>
        <ion-button (click)="showData()">do sum shit</ion-button>
    </ion-card-content>
</ion-content>